// 建议库的测试功能
tinymce.PluginManager.add('advicemet', function (editor, url) {
  // 注册一个工具栏按钮名称
  editor.ui.registry.addButton('advicemet', {
    text: '建议',
    onAction: function () {
      var csrf = $('input[name="csrfmiddlewaretoken"]').val();
      $.ajax({
        url: "tinymce/advicemet",
        type: "post",
        timeout: 2500,
        data: {
          'csrfmiddlewaretoken': csrf
        },
        dataType: "json",
        success: function (response) {
          console.log(response)
          // editor.insertContent(response.data); 
          layui.use('transfer', function () {
            var transfer = layui.transfer;         
            //渲染
            transfer.render({
              elem: '#transform'
              , data: response.datalist
              , title: ['建议库', '已选库']
              , showSearch: true
              , onchange: function (obj, index) {
                var arr = ['左边', '右边'] 
                var getData = transfer.getData('transformvalue');
                var head = '<p><span style="font-size: 20px;"><strong>服务建议：</strong></span></p><ol>'
                var midhead = '<li style="line-height: 2; font-family: 楷体;"><span style="font-family: 楷体;">'
                var midfoot = '</span></li>'
                var foot = '</ol>'
                var texthtml = ''
                texthtml = texthtml + head 
                for (var i = 0; i <getData.length; i++) {
                  texthtml = texthtml + midhead + getData[i].value + midfoot
                }
                texthtml = texthtml + foot  
                window.parent.postMessage({
                  mceAction: 'insertContent',
                  content: texthtml
                }, '*');       
              }
              ,id:'transformvalue'
              , text: {
                none: '无数据' //没有数据时的文案
                , searchNone: '无匹配数据' //搜索无匹配数据时的文案
              }
            })
          });            
          $('#modal-000003').click()
        }
      });
    }
  });



});





