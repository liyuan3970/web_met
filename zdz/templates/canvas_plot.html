<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="static/css/jquery.datetimepicker.css" />
    <script src="static/js/jquery.datetimepicker.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.actual/1.0.19/jquery.actual.min.js"></script>
    <!-- leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
        integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
        integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
    <!-- 使用turf -->
    <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
    <!-- echart -->
    <script type="text/javascript" src="static/js/echarts.min.js"></script>
    <script type="text/javascript" src="static/js/echarts-gl.min.js"></script>
    <script type="text/javascript" src="static/js/ecStat.min.js"></script>
    <script type="text/javascript" src="static/js/dataTool.min.js"></script>
    <script type="text/javascript" src="static/js/china.js"></script>
    <script type="text/javascript" src="static/js/world.js"></script>
    <!-- 数据 -->
    <script src='static/js/taizhou.js'></script>
    <script src='static/js/county.js'></script>
    <script src='static/js/taizhoulist.js'></script>
    <title>快速画图</title>
    <style type="text/css">
        .scrollbar::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body>
    {% csrf_token %}
    <div
        style="display: flex;align-content:flex-start;position: absolute; justify-content: center; flex-wrap: wrap; width: 100%;height: 100%;background-color: rgb(213, 217, 230);">
        <div class="col-md-12 column" style="width: 100%;height: 100%;padding-top: 15px;">
            <div class="tabbable" id="tabs-611922" style="width: 100%;height: 100%;">
                <ul class="nav nav-tabs" style="border: 1px solid">
                    <li class="active">
                        <a href="#canvas-1" data-toggle="tab">降水订正</a>
                    </li>
                    <li>
                        <a id="quick_plot_link" href="#canvas-2" data-toggle="tab">快速绘图</a>
                    </li>
                    <li>
                        <a href="#canvas-3" data-toggle="tab">趋势图</a>
                    </li>

                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="canvas-1">
                        <!-- 自定义绘图的位置 -->
                        <div style="display: flex;width: 100%;height:700px">
                            <!-- 自定义绘图 -->
                            <div style="width: 50%;height:700px;border: 1px solid">
                                <div style="width: 100%;height:5%;border: 1px solid">
                                    &nbsp;&nbsp;&nbsp;
                                    <select>
                                        <option value="+">+</option>
                                        <option value="-">-</option>
                                    </select>
                                    0.1<input checked="checked" type="radio" name="canvas_num" style="width:5%"
                                        value="0.1">
                                    0.3<input type="radio" name="canvas_num" style="width:5%" value="0.3">
                                    0.5<input type="radio" name="canvas_num" style="width:5%" value="0.5">
                                    1<input type="radio" name="canvas_num" style="width:5%" value="1">
                                    3<input type="radio" name="canvas_num" style="width:5%" value="3">
                                    5<input type="radio" name="canvas_num" style="width:5%" value="5">
                                    10<input type="radio" name="canvas_num" style="width:5%" value="10">

                                </div>
                                <div style="width: 100%;height:70%;border: 1px solid">
                                    <canvas id="plot_canvas"
                                        style="width:100%;height:100%;background-color: aqua;"></canvas>
                                </div>

                                <div style="display: flex;width: 100%;height:25%;border: 1px solid">
                                    <!--画图 菜单 -->
                                    <div style="width: 5%;height:100%;border: 1px solid">
                                        <button id="plot_1st_data" style="width: 100%;height:20%">1</button>
                                        <button id="plot_1st_color" style="width: 100%;height:20%">2</button>


                                    </div>

                                    <div style="width: 95%;height:100%;border: 1px solid">
                                        <!-- 工具栏 -->
                                        <div style="width: 100%;height:70%;border: 1px solid">
                                            <div id="plot_1st_tool1"
                                                style="display:inline-block;width:100%;height:100%">
                                                <div style="width:100%;height:30%;"></div>
                                                <div style="width:100%;height:70%;">
                                                    <label style="width:10%;height:40%;">&nbsp;&nbsp;&nbsp;</label>

                                                    <select
                                                        style="width: 10%;height:40%;; text-align:center;vertical-align: middle;align-items: center;">
                                                        <option>模式</option>
                                                        <option>自动站</option>
                                                        <option>市台</option>
                                                    </select>
                                                    &nbsp;&nbsp;&nbsp;

                                                    <input id="self_plot_start_time" type="text" placeholder="起始时间"
                                                        style="width: 20%;height:40%; text-align:center;vertical-align: middle;align-items: center; ">

                                                    <label>至</label>

                                                    <input id="self_plot_end_time" type="text" placeholder="结束时间"
                                                        style="width: 20%;height:40%; text-align:center;vertical-align: middle;align-items: center; ">
                                                    <label style="width:10%;height:40%;">&nbsp;&nbsp;&nbsp;</label>

                                                    <button id="self_plot_download"
                                                        style="width: 2.5%;height:40%;;border: 0px ;; text-align:center;vertical-align: middle;align-items: center;background-image: url(static/src/查询.png);background-size: 100%;background-repeat: no-repeat;"></button>

                                                </div>

                                            </div>
                                            <div id="plot_1st_tool2" style="display:none;width:100%;height:100%">
                                                2
                                            </div>

                                        </div>
                                        <!-- 按钮 -->
                                        <div style="width: 100%;height:30%;border: 1px solid">
                                            <input id="plot_self_button" type="button" value="绘制"
                                                style="width:10%;height: 100%;float:right">
                                            <input id="plot_self_flash" type="button" value="刷新"
                                                style="width:10%;height:100%;float:right">
                                            <input id="plot_self_close" type="button" value="关闭"
                                                style="width:10%;height:100%;float:right">

                                        </div>

                                    </div>


                                </div>

                            </div>
                            <!-- 预览 -->
                            <div style="width: 50%;height:700px;border: 1px solid">
                                <div id="self_plot_div" style="width: 100%;height:100%;border: 1px solid">

                                </div>
                                <!-- <div style="display: inline-flex;width: 100%;height:25%;border: 1px solid">
                                    <div id="self_bar" style="width: 60%;height:100%;border: 1px solid">

                                    </div>
                                    <div id="self_table" style="width: 40%;height:100%;border: 1px solid">

                                    </div>

                                </div> -->

                            </div>
                            <!-- 自定义画图的核心js -->
                            <script src='static/js/self_plot.js'></script>
                            <script>
                                // 绘制底图
                                var boundaries = {
                                    type: "FeatureCollection",
                                    name: "boundaries",
                                    crs: { type: "name", properties: { name: "urn:ogc:def:crs:OGC:1.3:CRS84" } },
                                    features: taizhoulist
                                };
                                var lines = L.geoJSON(boundaries, {
                                    style: function (feature) {
                                        return { color: 'black', weight: 1, fillOpacity: 0.1 };
                                    }
                                })
                                var map = new L.Map('self_plot_div', {
                                    center: new L.LatLng(28.7, 121.1),//110.763, 41.376   39.62353145, 121.9937485
                                    zoom: 9, //4
                                    zoomControl: false,
                                    dragging: false,
                                    // scrollWheelZoom: false,
                                    doubleClickZoom: false,
                                    attributionControl: false, //是否去除右下角标志
                                    bounds: turf.bbox(boundaries),
                                    layers: [lines]
                                });

                                // 关闭对话并传参
                                $('#plot_self_close').click(function () {
                                    window.parent.postMessage({
                                        mceAction: 'insertContent',
                                        content: "关闭选项"
                                    }, '*');
                                    window.parent.postMessage({
                                        mceAction: 'close'
                                    }, "*");
                                })

                                $('#self_plot_start_time').datetimepicker(
                                    {
                                        theme: 'dark',
                                        format: 'Y-m-d H:i',
                                        minView: "month",
                                        language: 'zh',
                                        startView: 2

                                    }
                                );
                                $("#self_plot_start_time").datetimepicker("setDate", new Date());

                                $('#self_plot_end_time').datetimepicker(
                                    {
                                        theme: 'dark',
                                        format: 'Y-m-d H:i'
                                    }
                                );

                                $('#plot_1st_data').click(function () {

                                    $('#plot_1st_tool1').attr("style", "display:inline-block;width:100%;height:100%")
                                    $('#plot_1st_tool2').attr("style", "display:none;width:100%;height:100%")
                                })
                                $('#plot_1st_color').click(function () {
                                    $('#plot_1st_tool1').attr("style", "display:none;width:100%;height:100%")
                                    $('#plot_1st_tool2').attr("style", "display:inline-block;width:100%;height:100%")
                                })
                                $('#self_plot_download').click(function () {
                                    var csrf = $('input[name="csrfmiddlewaretoken"]').val();
                                    var self_plot_start_time = $('#self_plot_start_time').val();
                                    var self_plot_end_time = $('#self_plot_end_time').val();
                                    self_plot_object.download(csrf, self_plot_start_time, self_plot_end_time)
                                })
                                //绘制图片时的代码
                                $('#plot_self_button').click(function () {
                                    var csrf = $('input[name="csrfmiddlewaretoken"]').val();
                                    self_plot_object.plot(csrf, map)

                                    //isobandsLay.addTo(map)

                                })
                                $('#plot_self_flash').click(function () {
                                    var csrf = $('input[name="csrfmiddlewaretoken"]').val();
                                    self_plot_object.flush(csrf)

                                })
                            </script>

                        </div>

                    </div>
                    <div class="tab-pane" id="canvas-2">
                        <div style="width: 100%;height:700px;border: 1px solid">
                            <div style="width: 100%;height:700px">
                                <div style="display: flex;width: 100%;height:100%;border: 1px solid">
                                    <!-- 底图选项 -->
                                    <div style="width: 20%;height:100%;border: 1px solid">
                                        <button id="bg_town"
                                            style="width: 100%;height:30%;background-image: url(static/src/shp_county.png);background-size: 100%;background-repeat: no-repeat;"></button>
                                        <button
                                            style="width: 100%;height:30%;background-image: url(static/src/shp_county.png);background-size: 100%;background-repeat: no-repeat;"></button>
                                        <button
                                            style="width: 100%;height:30%;background-image: url(static/src/shp_county.png);background-size: 100%;background-repeat: no-repeat;"></button>

                                    </div>
                                    <script>
                                        $("#bg_town").click(function () {
                                            const quick_plot = document.getElementById("quick_plot");
                                            quick_plot_object.geoData = tz_json
                                            quick_plot_object.run(quick_plot)

                                        })
                                    </script>
                                    <div style="width: 80%;height:100%;border: 1px solid">
                                        <div style="width: 100%;height:85%;border: 1px solid">
                                            <canvas id="quick_plot"
                                                style="width: 100%;height:100%;background-color: white;"></canvas>

                                        </div>

                                        <script src='static/js/quick_plot.js'></script>
                                        <div style="width: 100%;height:15%;border: 1px solid">
                                            <!-- 工具栏 -->
                                            <div
                                                style="display:inline-block;width:100%;height:30%;border: 1px solid black">
                                                等值线:&nbsp;<input id="taizhou_quick_plot_contour" type="radio"
                                                    checked="checked" name="taizhou_quick_plot_type"
                                                    value="contour">&nbsp;&nbsp;&nbsp;
                                                图示:&nbsp;<input id="taizhou_quick_plot_icon" type="radio"
                                                    name="taizhou_quick_plot_type"
                                                    value="scatter_icon">&nbsp;&nbsp;&nbsp;
                                                文字:&nbsp;<input id="taizhou_quick_plot_text" type="radio"
                                                    name="taizhou_quick_plot_type"
                                                    value="scatter_text">&nbsp;&nbsp;&nbsp;
                                                图例:&nbsp;<input id="taizhou_quick_plot_pic" type="radio"
                                                    name="taizhou_quick_plot_type"
                                                    value="scatter_pic">&nbsp;&nbsp;&nbsp;

                                                <input id="forward_canvas" type="button" value="前进"
                                                    style="float: right;">
                                                <input id="reback_canvas" type="button" value="撤回"
                                                    style="float: right;">
                                                <input id="flash_canvas" type="button" value="刷新" style="float: right;">

                                            </div>
                                            <div id="taizhou_quick_plot_type_view0"
                                                style="display:inline-block;width:100%;height:70%;">
                                                <select id="view0_color">
                                                    <option value="black">黑色</option>
                                                    <option value="red">红色</option>
                                                    <option value="blue">蓝色</option>
                                                </select>
                                                <select id="view0_line">
                                                    <option value="contour">等值线</option>
                                                    <option value="line">曲线</option>
                                                </select>
                                                <label>粗细</label>
                                                <input id="view0_width" type="number" value=3>


                                            </div>
                                            <div id="taizhou_quick_plot_type_view1"
                                                style="display:none;width:100%;height:70%;border: 3px solid black">
                                                <img class="icon_scatter" src="static/src/icon/35到37度.png"
                                                    style="width:50px;height:50px">
                                                <img class="icon_scatter" src="static/src/icon/6-8级大风.png"
                                                    style="width:50px;height:50px">
                                                <img class="icon_scatter" src="static/src/icon/40度以上.png"
                                                    style="width:50px;height:50px">
                                                <img class="icon_scatter" src="static/src/icon/7-9级大风.png"
                                                    style="width:50px;height:50px">
                                                <img class="icon_scatter" src="static/src/icon/7~9级雷雨大风.png"
                                                    style="width:50px;height:50px">


                                            </div>
                                            <div id="taizhou_quick_plot_type_view2"
                                                style="display:none;width:100%;height:70%;border: 3px solid black">
                                                内容:&nbsp;<input id="taizhou_quick_plot_text_content" placeholder="请输入文字"
                                                    value="请输入文字" type="text" style="width: 40%;">
                                                大小:&nbsp;<input id="taizhou_quick_plot_text_size" type="number" max="80"
                                                    min="0" placeholder="25" style="width: 6%;">


                                            </div>
                                            <div id="taizhou_quick_plot_type_view3"
                                                style="display:none;width:100%;height:70%;border: 3px solid black">
                                                <!-- 添加颜色的radio -->
                                                <div id="color_select_list"
                                                    style="display: inline-block;width:100%;height: 40%; "></div>
                                                <div style="width:100%;height: 10%; "></div>

                                                <select id="color_select_option" style="width: 10%;height: 35%;">
                                                    <option style="display:none" value="none"></option>
                                                    <option value="black">黑色</option>
                                                    <option value="green">绿色</option>
                                                    <option value="red">红色</option>
                                                    <option value="blue">蓝色</option>
                                                </select>

                                                <input id="color_bar_del" type="button" value="删除"
                                                    onclick="color_bar_del()"
                                                    style="width: 10%;height: 35%;float: right;">


                                            </div>

                                            <script type="text/javascript">
                                                $('#flash_canvas').click(function () {
                                                    const quick_plot = document.getElementById("quick_plot");
                                                    quick_plot_object.geoData = tz_json
                                                    quick_plot_object.run(quick_plot)



                                                })

                                                $('#reback_canvas').click(function () {
                                                    if (quick_plot_object.memory_list.length - 1 > quick_plot_object.click_num) {
                                                        quick_plot_object.ctx_quick_plot.clearRect(0, 0, quick_plot_object.canvasW, quick_plot_object.canvasH)
                                                        quick_plot_object.ctx_quick_plot.putImageData(quick_plot_object.memory_list[quick_plot_object.memory_list.length - 2 - quick_plot_object.click_num], 0, 0);
                                                        quick_plot_object.click_num = quick_plot_object.click_num + 1


                                                    }

                                                })

                                                $('#forward_canvas').click(function () {
                                                    if (quick_plot_object.click_num != 0) {
                                                        quick_plot_object.ctx_quick_plot.clearRect(0, 0, quick_plot_object.canvasW, quick_plot_object.canvasH)
                                                        quick_plot_object.ctx_quick_plot.putImageData(quick_plot_object.memory_list[quick_plot_object.memory_list.length - quick_plot_object.click_num], 0, 0);
                                                        quick_plot_object.click_num = quick_plot_object.click_num - 1

                                                    }
                                                    else {
                                                        quick_plot_object.ctx_quick_plot.clearRect(0, 0, quick_plot_object.canvasW, quick_plot_object.canvasH)
                                                        quick_plot_object.ctx_quick_plot.putImageData(quick_plot_object.memory_list[quick_plot_object.memory_list.length - 1], 0, 0);

                                                    }

                                                })

                                                $('#color_select_option').change(function () {
                                                    var select_color = $('#color_select_option option:selected').val();
                                                    if (select_color != 'none') {
                                                        var add_radio = document.createElement('input')
                                                        add_radio.style.width = "8%"
                                                        add_radio.style.height = "80%"
                                                        add_radio.style.backgroundColor = select_color
                                                        add_radio.style.display = "inline-block"
                                                        add_radio.style.border = "1px solid black"
                                                        add_radio.setAttribute("class", "color_bar")
                                                        add_radio.setAttribute("type", "text")
                                                        $('#color_select_list').append(add_radio)
                                                    }

                                                })

                                                function color_bar_del() {
                                                    $('#color_select_list').children().last().remove()
                                                    quick_plot_object.labelinfo.color.pop()
                                                    quick_plot_object.labelinfo.text.pop()
                                                    // console.log($(".color_bar").val())
                                                }
                                                var el = window.document.body; //声明一个变量，默认值为body
                                                var select_icon_img = []
                                                window.document.body.onmouseover = function (event) {
                                                    el = event.target; //鼠标每经过一个元素，就把该元素赋值给变量el
                                                    var class_name = el.className
                                                    el.addEventListener("click", function () {
                                                        if (class_name == 'icon_scatter') {
                                                            $('.icon_scatter').css("border", "0px")
                                                            el.setAttribute("border", "3px")
                                                            el.style.border = "3px solid red"
                                                            select_icon_img = []
                                                            select_icon_img.push(el)
                                                            console.log(el.className)

                                                        }


                                                    })

                                                }
                                                // var taizhou_quick_plot_type = $("input[name='taizhou_quick_plot_type']:checked").val()

                                                // 前端绘图模块的
                                                $('#taizhou_quick_plot_contour').click(function () {
                                                    $('#taizhou_quick_plot_type_view0').attr("style", "display:inline-block;width:100%;height:70%;border: 3px solid black");
                                                    $('#taizhou_quick_plot_type_view1').attr("style", "display:none;width:100%;height:70%;border: 3px solid black");
                                                    $('#taizhou_quick_plot_type_view2').attr("style", "display:none;width:100%;height:70%;border: 3px solid black");
                                                    $('#taizhou_quick_plot_type_view3').attr("style", "display:none;width:100%;height:70%;border: 3px solid black");

                                                })

                                                $('#taizhou_quick_plot_icon').click(function () {
                                                    $('#taizhou_quick_plot_type_view0').attr("style", "display:none;width:100%;height:70%;border: 3px solid black");
                                                    $('#taizhou_quick_plot_type_view1').attr("style", "display:inline-block;width:100%;height:70%;border: 3px solid black");
                                                    $('#taizhou_quick_plot_type_view2').attr("style", "display:none;width:100%;height:70%;border: 3px solid black");
                                                    $('#taizhou_quick_plot_type_view3').attr("style", "display:none;width:100%;height:70%;border: 3px solid black");

                                                })
                                                $('#taizhou_quick_plot_text').click(function () {
                                                    $('#taizhou_quick_plot_type_view0').attr("style", "display:none;width:100%;height:70%;border: 3px solid black");
                                                    $('#taizhou_quick_plot_type_view1').attr("style", "display:none;width:100%;height:70%;border: 3px solid black");
                                                    $('#taizhou_quick_plot_type_view2').attr("style", "display:inline-block;width:100%;height:70%;border: 3px solid black");
                                                    $('#taizhou_quick_plot_type_view3').attr("style", "display:none;width:100%;height:70%;border: 3px solid black");

                                                })
                                                $('#taizhou_quick_plot_pic').click(function () {
                                                    $('#taizhou_quick_plot_type_view0').attr("style", "display:none;width:100%;height:70%;border: 3px solid black");
                                                    $('#taizhou_quick_plot_type_view1').attr("style", "display:none;width:100%;height:70%;border: 3px solid black");
                                                    $('#taizhou_quick_plot_type_view2').attr("style", "display:none;width:100%;height:70%;border: 3px solid black");
                                                    $('#taizhou_quick_plot_type_view3').attr("style", "display:inline-block;width:100%;height:70%;border: 3px solid black");
                                                })



                                            </script>

                                        </div>

                                    </div>




                                </div>

                            </div>

                        </div>


                    </div>
                    <div class="tab-pane" id="canvas-3">
                        <div style="display: flex;width: 100%;height:700px;border: 1px solid">
                            <!-- 数据栏 -->
                            <div style="display: flex;width: 30%;height:700px;border: 1px solid">
                                <div style="width: 10%;height:700px;border: 1px solid">
                                    <button id="clonadd" style="width:100%;height: 10%;">加</button>
                                    <button id="clondel" style="width:100%;height: 10%;">减</button>
                                </div>
                                <div style="width: 90%;height:700px;border: 1px solid">
                                    <div style="width: 100%;height:10%;border: 1px solid">
                                        <button id="rowadd" style="width:10%;height: 100%;">加</button>
                                        <button id="rowdel" style="width:10%;height: 100%;">减</button>
                                    </div>
                                    <!-- 数据 -->
                                    <div style=";width: 100%;height:80%;border: 1px solid">
                                        <div style="display: inline-flex;width: 100%;height:10%;border: 1px solid">
                                            <div style=";width: 10%;height:100%;border: 1px solid">

                                            </div>
                                            <div id="series_name" style=";width: 90%;height:100%;border: 1px solid">

                                            </div>


                                        </div>
                                        <div style="display: inline-flex;width: 100%;height:90%;border: 1px solid">
                                            <div id="index_name" style=";width: 10%;height:100%;border: 1px solid">

                                            </div>

                                            <div id="data_line"
                                                style="display: flex;;width: 90%;height:100%;border: 1px solid">

                                            </div>

                                        </div>

                                    </div>

                                    <!-- 选项 -->
                                    <div style="width: 100%;height:10%;border: 1px solid"></div>
                                </div>
                                <script>
                                    var plot_line_obj = {
                                        data: [],
                                        rownum: undefined,
                                        clonnum: undefined,
                                        series: undefined,
                                        xAxis:undefined,
                                        initfnc: function () {
                                            this.rownum = 4
                                            this.clonnum = 7
                                            var data_line = document.getElementById("data_line")
                                            var index_div = document.getElementById("index_name")
                                            for (var j = 0; j < this.clonnum; j++) {
                                                var index_label = document.createElement("div")
                                                index_label.innerText = j.toString()
                                                index_label.style = "width: 100%;height:5%;border: 1px solid"
                                                index_div.append(index_label)

                                            }
                                            for (var i = 0; i < this.rownum; i++) {
                                                var data_single_line = document.createElement("div")
                                                data_single_line.style = "width: 10%;height:100%;border: 1px solid"
                                                var series_name_div = document.getElementById("series_name")
                                                var series_name = document.createElement("label")
                                                series_name.style = "width: 10%;height:100%;border: 1px solid"
                                                if (i == 0) {
                                                    series_name.innerText = "X"

                                                }
                                                else {
                                                    series_name.innerText = "y" + i.toString()
                                                }
                                                series_name_div.append(series_name)
                                                for (var j = 0; j < this.clonnum; j++) {

                                                    var single_clon = document.createElement("input")
                                                    single_clon.style = "width: 100%;height:5%;border: 1px solid"
                                                    single_clon.setAttribute("class", "plot_value")
                                                    if(i!=0){
                                                        single_clon.value = Math.random()*100
                                                    }
                                                    
                                                    data_single_line.append(single_clon)
                                                }
                                                data_line.append(data_single_line)
                                            }
                                        },
                                        rowadd: function () {
                                            this.rownum = this.rownum + 1
                                            var data_line = document.getElementById("data_line")
                                            var data_single_line = document.createElement("div")
                                            data_single_line.style = "width: 10%;height:100%;border: 1px solid"
                                            for (var j = 0; j < this.clonnum; j++) {
                                                var single_clon = document.createElement("input")
                                                single_clon.style = "width: 100%;height:5%;border: 1px solid"
                                                single_clon.setAttribute("class", "plot_value")
                                                data_single_line.append(single_clon)
                                            }
                                            data_line.append(data_single_line)

                                        },
                                        clonadd: function () {
                                            this.clonnum = this.clonnum + 1
                                            var data_line = document.getElementById("data_line")
                                            var line_list = data_line.children
                                            for (var i = 0; i < line_list.length; i++) {
                                                var single_row = line_list[i]
                                                var single_clon = document.createElement("input")
                                                single_clon.style = "width: 100%;height:5%;border: 1px solid"
                                                single_clon.setAttribute("class", "plot_value")
                                                single_row.append(single_clon)
                                            }
                                        },
                                        rowdel: function () {
                                            this.rownum = this.rownum - 1
                                            var data_line = document.getElementById("data_line")
                                            data_line.lastChild.remove()
                                        },
                                        clondel: function () {
                                            this.clonnum = this.clonnum - 1
                                            var data_line = document.getElementById("data_line")
                                            for (var i = 0; i < data_line.childElementCount; i++) {

                                                var single_line = data_line.children[i]
                                                single_line.lastChild.remove()
                                            }
                                        },
                                        getdata: function () {
                                            console.log("fun-getdata")
                                            var data = []
                                            $(".plot_value").each(function () {
                                                data.push(this.value)
                                            })
                                            //数据列表
                                            var return_data = []
                                            var item_index = 0
                                            var series = []
                                            var axisx = undefined
                                            for (var i = 0; i < this.rownum; i++) {
                                                var single_list = []
                                                for (var j = 0; j < this.clonnum; j++) {
                                                    single_list.push(data[item_index])
                                                    item_index = item_index + 1
                                                }
                                                return_data.push(single_list)
                                                if (i==0){
                                                    axisx = single_list
                                                }
                                                else{
                                                    var datasingle = {
                                                        name: 'data'+i.toString(),
                                                        type: 'line',
                                                        yAxisIndex: 0,
                                                        data: single_list
                                                    }
                                                    series.push(datasingle)

                                                }
                                                
                                            }
                                            this.series = series
                                            this.xAxis = axisx
                                        },
                                    }
                                    plot_line_obj.initfnc()
                                    $("#rowadd").click(function () {
                                        plot_line_obj.rowadd()
                                    })
                                    $("#clonadd").click(function () {
                                        plot_line_obj.clonadd()
                                    })
                                    $("#rowdel").click(function () {
                                        plot_line_obj.rowdel()
                                    })
                                    $("#clondel").click(function () {
                                        plot_line_obj.clondel()
                                    })
                                </script>

                            </div>

                            <div style="width: 70%;height:700px;border: 1px solid">
                                <!-- 绘图区 -->
                                <div id="line_plot" style="width: 100%;height:600px;border: 1px solid">

                                </div>
                                <!-- 按钮组 -->
                                <div style="width: 100%;height:100px;border: 1px solid">
                                    <button id="getdata" style="width: 10%;height:100px;border: 1px solid">获取数据</button>
                                    <button id="plot" style="width: 10%;height:100px;border: 1px solid">绘图</button>

                                </div>
                                <script>
                                    $("#getdata").click(function () {                           
                                        plot_line_obj.getdata()
                                    })
                                    $("#plot").click(function () {
                                        const colors = ['#5470C6', '#91CC75', '#EE6666'];
                                        const lineChart = echarts.init(document.getElementById("line_plot"));//echarts.init($("#ec_line")[0]);
                                        lineChart.setOption({
                                            color: colors,
                                            backgroundColor: 'white',
                                            title: {
                                                text: '',
                                                left: 'left',
                                                textStyle: {
                                                    color: '#826'
                                                }
                                            },
                                            tooltip: {
                                                triggerOn: 'none',
                                                // formatter: function (params) {
                                                //     return (
                                                //         'X: ' +
                                                //         params.data[0] +
                                                //         '<br>Y: ' +
                                                //         params.data[1].toFixed(2)
                                                //     );
                                                // }
                                            },
                                            grid: {
                                                top: '8%',
                                                right: '6%',
                                                left: '6%',
                                                bottom: '8%'
                                            },
                                            xAxis: [
                                                {
                                                    type: 'category',
                                                    // type: 'value',
                                                    axisTick: {
                                                        alignWithLabel: true
                                                    },
                                                    // prettier-ignore
                                                    data: plot_line_obj.xAxis
                                                }
                                            ],
                                            yAxis: [{
                                                type: 'value',
                                                name: '降水',
                                                position: 'right',
                                                alignTicks: true,
                                                // offset: 80,
                                                max: function (value) {
                                                    return value.max * 2.5;
                                                },
                                                axisLine: {
                                                    show: true,
                                                    lineStyle: {
                                                        color: "blue"
                                                    }
                                                },
                                                axisLabel: {
                                                    formatter: '{value} mm'
                                                }
                                            },
                                            {
                                                type: 'value',
                                                name: '温度',
                                                position: 'left',
                                                alignTicks: true,
                                                max: function (value) {
                                                    return value.max + 3;
                                                },
                                                min: function (value) {
                                                    return value.min - 10;
                                                },
                                                axisLine: {
                                                    show: true,
                                                    lineStyle: {
                                                        color: "red"
                                                    }
                                                },
                                                axisLabel: {
                                                    formatter: '{value} °C'
                                                }
                                            }],
                                            series:plot_line_obj.series      
                                            // series: [
                                            //     {
                                            //         name: '降水1',
                                            //         id: "a",
                                            //         type: 'bar',
                                            //         yAxisIndex: 0,
                                            //         data: [1,2,3,4,5,6,7,8]
                                            //     },
                                            //     {
                                            //         name: '降水2',
                                            //         id: "b",
                                            //         type: 'bar',
                                            //         yAxisIndex: 0,
                                            //         data: [1,2,3,4,5,6,7,8]
                                            //     },
                                            //     {
                                            //         name: '温度',
                                            //         id: "c",
                                            //         type: 'line',
                                            //         smooth: true,
                                            //         yAxisIndex: 1,
                                            //         data: [1,2,3,4,5,6,7,8]
                                            //     }
                                            // ]
                                        });



                                    })
                                </script>

                            </div>


                        </div>
                    </div>

                </div>
            </div>
        </div>



    </div>
    {% csrf_token %}
</body>

</html>